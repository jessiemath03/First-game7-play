<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¤©ç§¤ç ç¢¼å¤§å°æ±ºï½œJessie Math</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --primary: #ffb703;
      --primary-dark: #fb8500;
      --bg: #f8faff; 
      --text: #2c3e50;
      --nav-border: #e2e8f0;
      --nav-text: #4a5568;
      --nav-hover: #edf2f7;
      --back-btn-color: #6366f1;
      --success: #10b981;
      --danger: #ef4444;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }

    /* --- é®ç½©å±¤æ¨£å¼ --- */
    .overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.98);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(8px);
    }

    .modal-box {
      background: white;
      padding: 40px;
      border-radius: 24px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.1);
      text-align: center;
      max-width: 400px;
      width: 90%;
    }

    .action-btn {
      width: 100%; padding: 12px; background: var(--primary);
      border: none; border-radius: 12px; color: white;
      font-size: 18px; font-weight: bold; cursor: pointer; margin-bottom: 10px;
    }

    .secondary-btn { background: #e2e8f0; color: #4a5568; }

    /* --- Hero Header --- */
    .hero-header {
      background: #ffffff; padding: 12px 24px;
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid #f0f0f0;
    }

    .brand-area { display: flex; align-items: center; gap: 12px; }
    .brand-logo-circle {
      width: 48px; height: 48px; background: var(--primary);
      border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden;
    }
    .brand-logo-circle img { width: 85%; }
    .brand-name { font-size: 24px; font-weight: 700; color: #1e293b; letter-spacing: -0.5px; }

    .nav-area { display: flex; gap: 10px; }
    .nav-item {
      display: inline-flex; align-items: center; gap: 6px; padding: 8px 18px;
      border-radius: 999px; text-decoration: none; font-size: 14px;
      color: var(--nav-text); border: 1px solid var(--nav-border); background: white; cursor: pointer;
    }

    /* --- éŠæˆ²ä¸»å€å¡Š --- */
    .main-container {
      max-width: 1100px; margin: 20px auto;
      display: grid; grid-template-columns: 1fr 300px; gap: 20px; padding: 0 16px;
    }

    .game-card {
      background: white; border-radius: 24px; padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.05); position: relative;
    }

    .status-bar {
      display: flex; justify-content: space-around; background: #f1f5f9;
      padding: 10px; border-radius: 15px; margin-bottom: 15px; font-weight: bold;
    }

    /* --- é¡Œç›®é¡¯ç¤ºå€ --- */
    .task-display-area {
      text-align: center; margin-bottom: 20px;
    }

    #leftText {
      display: inline-block;
      font-size: 2rem;
      font-weight: 900;
      color: var(--primary-dark);
      background: #fff8e1;
      padding: 8px 30px;
      border-radius: 15px;
      border: 3px solid var(--primary);
      box-shadow: 0 4px 0px var(--primary);
    }

    /* --- å¤©ç§¤è¦–è¦º (å¯¬æ‰˜ç›¤) --- */
    .stage {
      height: 220px; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
      position: relative; margin-bottom: 30px;
    }
    .balance-pillar { width: 24px; height: 120px; background: #795548; position: relative; }
    .balance-beam {
      width: 460px; height: 14px; background: #d4af37; border-radius: 7px;
      position: absolute; top: 0; left: 50%; transform: translateX(-50%);
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex; justify-content: space-between; padding: 0 10px;
    }
    .pan-container {
      width: 180px; height: 200px; position: absolute; top: 14px;
      display: flex; flex-direction: column; align-items: center;
      transition: transform 0.6s ease;
    }
    .pan-left-side { left: -90px; }
    .pan-right-side { right: -90px; }
    
    /* æ‰˜ç›¤è¦–è¦º */
    .pan-dish {
      width: 180px; min-height: 40px; background: #e0e0e0; 
      border-top: 6px solid #bdc3c7; border-radius: 4px;
      display: flex; flex-wrap: wrap; justify-content: center; 
      align-content: flex-end; padding: 10px 5px;
      position: relative; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .mystery-box { 
        width: 60px; height: 60px; background: #e67e22; color: white; 
        border-radius: 8px; display: flex; align-items: center; justify-content: center; 
        font-weight: bold; position: absolute; top: -60px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
    }

    #rightHint { margin-top: 15px; font-weight: bold; color: #bdc3c7; }

    /* --- ç ç¢¼æŒ‰éˆ• --- */
    .controls { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
    .weight-btn {
      padding: 12px 5px; border: 2px solid #e2e8f0; border-radius: 12px; 
      background: white; cursor: pointer; font-weight: bold; font-size: 15px;
    }
    .weight-btn:hover { background: var(--primary); color: white; }

    .game-actions { margin-top: 20px; display: flex; gap: 12px; }
    .game-actions button { padding: 12px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; font-size: 16px; }

    /* --- æ’è¡Œæ¦œ --- */
    .leaderboard-card { background: white; border-radius: 24px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
    .leaderboard-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f1f5f9; }

    /* --- ç ç¢¼çƒ (é»æ“Šç§»é™¤) --- */
    .weight-node {
      width: 40px; height: 40px; background: #7f8c8d; border-radius: 50%; 
      margin: 2px; font-size: 10px; color: white; display: flex; 
      align-items: center; justify-content: center; box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
      cursor: pointer; transition: transform 0.2s;
    }
    .weight-node:hover { transform: scale(1.1); background: #e74c3c; }

    @media (max-width: 768px) {
      .main-container { grid-template-columns: 1fr; }
      .balance-beam { width: 320px; }
      .pan-container { width: 140px; }
      .pan-dish { width: 140px; }
      .pan-left-side { left: -70px; }
      .pan-right-side { right: -70px; }
      #leftText { font-size: 1.5rem; }
    }
  </style>
</head>
<body>

  <div id="loginOverlay" class="overlay">
    <div class="modal-box">
      <div class="brand-logo-circle" style="margin: 0 auto 15px; width: 64px; height: 64px;">
        <img src="JESSIEMATH-Q.png" alt="Logo">
      </div>
      <h2>å¤©ç§¤ç ç¢¼å¤§å°æ±º</h2>
      <p>è«‹è¼¸å…¥å†’éšªè€…å§“åï¼š</p>
      <input type="text" id="playerNameInput" placeholder="è¼¸å…¥å§“å..." maxlength="10" style="width:100%; padding:12px; margin-bottom:20px; border-radius:12px; border:2px solid #eee;">
      <button class="action-btn" onclick="startGame()">é–‹å§‹æŒ‘æˆ°</button>
    </div>
  </div>

  <div id="pauseOverlay" class="overlay" style="display: none;">
    <div class="modal-box">
      <h2>éŠæˆ²æš«åœä¸­</h2>
      <button class="action-btn" onclick="togglePause()">ç¹¼çºŒéŠæˆ²</button>
      <button class="action-btn secondary-btn" onclick="restartGame()">é‡æ–°é–‹å§‹</button>
      <button class="action-btn secondary-btn" onclick="goHome()">å›ä¸»é¸å–®</button>
    </div>
  </div>

  <header class="hero-header">
    <div class="brand-area">
      <div class="brand-logo-circle"><img src="JESSIEMATH-Q.png" alt="Logo"></div>
      <div class="brand-name">Jessie Math</div>
    </div>
    <nav class="nav-area">
      <div class="nav-item" onclick="togglePause()">â¸ï¸ æš«åœ</div>
      <div class="nav-item" onclick="restartGame()">ğŸ”„ é‡ä¾†</div>
      <div class="nav-item" onclick="goHome()">ğŸ  å›é¸å–®</div>
    </nav>
  </header>

  <main class="main-container">
    <div class="game-card">
      <div class="status-bar">
        <div>ç©å®¶: <span id="displayName">---</span></div>
        <div>å¾—åˆ†: <span id="scoreText">0</span></div>
        <div>å€’æ•¸: <span id="timeText">60</span>s</div>
      </div>

      <div class="task-display-area">
        <span style="color: #7f8c8d; font-size: 0.9rem; display: block; margin-bottom: 5px;">è«‹å¿ƒç®—å³å´é‡é‡ä½¿å¤©ç§¤å¹³è¡¡</span>
        <div id="leftText">---</div>
      </div>

      <div class="stage">
        <div class="balance-pillar">
          <div class="balance-beam" id="beam">
            <div class="pan-container pan-left-side" id="panL">
              <div class="pan-dish"><div class="mystery-box">?</div></div>
            </div>
            <div class="pan-container pan-right-side" id="panR">
              <div class="pan-dish" id="rightPanItems"></div>
              <div id="rightHint">é»é¸ä¸‹æ–¹ç ç¢¼</div>
            </div>
          </div>
        </div>
      </div>

      <div id="feedback" style="text-align: center; height: 30px; font-weight: bold; margin-bottom: 10px;"></div>

      <div class="controls" id="controls"></div>
      
      <div class="game-actions">
        <button onclick="resetCurrentRound()" style="flex:1; background: #f8f9fa; border: 2px solid #eee;">ğŸ§¹ æ¸…ç©ºæ‰˜ç›¤</button>
        <button onclick="checkAnswer()" style="flex:2; background: var(--primary); color:white; box-shadow: 0 4px 0 #e67e22;">âœ… æª¢æŸ¥å¹³è¡¡</button>
      </div>
    </div>

    <aside class="leaderboard-card">
      <h3>ğŸ† æœ¬æ©Ÿæ’è¡Œæ¦œ</h3>
      <ul id="leaderboardList" style="list-style: none; padding: 0;"></ul>
    </aside>
  </main>

  <script>
    // ä¿®æ”¹ç ç¢¼æ¸…å–®ï¼šç¢ºä¿é¡¯ç¤ºç‚ºæ•¸å­— 1000g
    const WEIGHTS = [
      { l: "1000g", v: 1000 }, { l: "500g", v: 500 }, { l: "100g", v: 100 },
      { l: "50g", v: 50 }, { l: "10g", v: 10 }, { l: "5g", v: 5 }, { l: "1g", v: 1 }
    ];
    const PAN_CAPACITY = 25; 

    let state = {
      playerName: "",
      score: 0,
      timeLeft: 60,
      targetG: 0,
      currentG: 0,
      selectedWeights: [],
      isPlaying: false,
      isPaused: false,
      timer: null
    };

    function startGame() {
      const nameInput = document.getElementById('playerNameInput');
      if (!nameInput.value.trim()) { alert("è«‹è¼¸å…¥å¤§åï¼"); return; }
      state.playerName = nameInput.value.trim();
      document.getElementById('displayName').innerText = state.playerName;
      document.getElementById('loginOverlay').style.display = 'none';
      initGame();
    }

    function initGame() {
      state.score = 0;
      state.timeLeft = 60;
      state.isPlaying = true;
      state.isPaused = false;
      document.getElementById('scoreText').innerText = "0";
      initControls();
      newRound();
      startTimer();
      updateLeaderboard();
    }

    function togglePause() {
      if (!state.isPlaying) return;
      state.isPaused = !state.isPaused;
      document.getElementById('pauseOverlay').style.display = state.isPaused ? 'flex' : 'none';
    }

    function restartGame() {
      clearInterval(state.timer);
      document.getElementById('pauseOverlay').style.display = 'none';
      initGame();
    }

    function goHome() {
      clearInterval(state.timer);
      state.isPlaying = false;
      document.getElementById('pauseOverlay').style.display = 'none';
      document.getElementById('loginOverlay').style.display = 'flex';
    }

    function initControls() {
      const ctrl = document.getElementById('controls');
      ctrl.innerHTML = '';
      WEIGHTS.forEach(w => {
        const b = document.createElement('button');
        b.className = 'weight-btn';
        b.innerText = w.l;
        b.onclick = () => addWeight(w);
        ctrl.appendChild(b);
      });
    }

    function newRound() {
      state.targetG = Math.floor(Math.random() * 2500) + 5; 
      state.selectedWeights = [];
      state.currentG = 0;
      document.getElementById('leftText').innerText = formatG(state.targetG);
      updateVisuals();
    }

    function addWeight(w) {
      if (!state.isPlaying || state.isPaused) return;
      if (state.selectedWeights.length >= PAN_CAPACITY) {
        showFeedback("æ‰˜ç›¤è£ä¸ä¸‹äº†ï¼", "var(--danger)");
        return;
      }
      state.selectedWeights.push(w);
      state.currentG += w.v;
      updateVisuals();
    }

    function removeWeight(index) {
      if (!state.isPlaying || state.isPaused) return;
      const removed = state.selectedWeights.splice(index, 1)[0];
      state.currentG -= removed.v;
      updateVisuals();
    }

    function resetCurrentRound() {
      state.selectedWeights = [];
      state.currentG = 0;
      updateVisuals();
    }

    function updateVisuals() {
      const dish = document.getElementById('rightPanItems');
      dish.innerHTML = '';
      state.selectedWeights.forEach((w, index) => {
        const node = document.createElement('div');
        node.className = 'weight-node';
        // æ‰˜ç›¤å…§çš„é¡¯ç¤ºä¹Ÿæ”¹ç‚ºç´”æ•¸å­—ï¼Œä¸ä½¿ç”¨ 1k
        node.innerText = w.v; 
        node.onclick = () => removeWeight(index);
        dish.appendChild(node);
      });

      document.getElementById('rightHint').innerText = 
        state.selectedWeights.length === 0 ? "é»é¸ä¸‹æ–¹ç ç¢¼" : `æ‰˜ç›¤ä¸Šæœ‰ ${state.selectedWeights.length} å€‹ (é»æ“Šå¯ç§»é™¤)`;

      const beam = document.getElementById('beam');
      const panL = document.getElementById('panL');
      const panR = document.getElementById('panR');
      const diff = state.currentG - state.targetG;
      const angle = Math.max(-18, Math.min(18, diff / 80));
      
      beam.style.transform = `translateX(-50%) rotate(${angle}deg)`;
      panL.style.transform = `rotate(${-angle}deg)`;
      panR.style.transform = `rotate(${-angle}deg)`;
    }

    function checkAnswer() {
      if (!state.isPlaying || state.isPaused) return;
      if (state.currentG === state.targetG) {
        state.score += 100;
        showFeedback("âœ¨ å®Œç¾å¹³è¡¡ï¼", "var(--success)");
        document.getElementById('scoreText').innerText = state.score;
        setTimeout(newRound, 1200);
      } else {
        const diff = Math.abs(state.targetG - state.currentG);
        showFeedback(`âŒ é‡é‡ä¸å°ï¼èª¤å·® ${formatG(diff)}`, "var(--danger)");
      }
    }

    function showFeedback(msg, color) {
      const fb = document.getElementById('feedback');
      fb.innerText = msg;
      fb.style.color = color;
      setTimeout(() => { if(fb.innerText === msg) fb.innerText = ""; }, 2000);
    }

    function formatG(g) {
      if (g >= 1000) {
        const k = Math.floor(g/1000);
        const r = g%1000;
        // é€™è£¡ç¶­æŒå¹¾å…¬æ–¤å¹¾å…¬å…‹ï¼Œå¹«åŠ©æ•™å­¸è½‰æ›
        return `${k}å…¬æ–¤ ${r > 0 ? r + 'å…¬å…‹' : ''}`;
      }
      return `${g}å…¬å…‹`;
    }

    function startTimer() {
      if (state.timer) clearInterval(state.timer);
      state.timer = setInterval(() => {
        if (state.isPaused) return;
        state.timeLeft--;
        document.getElementById('timeText').innerText = state.timeLeft;
        if (state.timeLeft <= 0) endGame();
      }, 1000);
    }

    function endGame() {
      clearInterval(state.timer);
      state.isPlaying = false;
      saveScore(state.playerName, state.score);
      alert(`æ™‚é–“åˆ°ï¼\nå†’éšªè€…ï¼š${state.playerName}\næœ€çµ‚å¾—åˆ†ï¼š${state.score}`);
      location.reload();
    }

    function saveScore(name, score) {
      let scores = JSON.parse(localStorage.getItem('jessieMath_Leaderboard') || '[]');
      scores.push({ name, score, date: new Date().toLocaleDateString() });
      scores.sort((a, b) => b.score - a.score);
      localStorage.setItem('jessieMath_Leaderboard', JSON.stringify(scores.slice(0, 5)));
    }

    function updateLeaderboard() {
      const list = document.getElementById('leaderboardList');
      const scores = JSON.parse(localStorage.getItem('jessieMath_Leaderboard') || '[]');
      if (scores.length === 0) { list.innerHTML = "<li>å°šç„¡ç´€éŒ„</li>"; return; }
      list.innerHTML = scores.map(s => `
        <li class="leaderboard-item">
          <span>${s.name}</span>
          <strong>${s.score} åˆ†</strong>
        </li>
      `).join('');
    }
  </script>
</body>
</html>